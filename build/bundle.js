!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="build/",r(r.s=5)}([function(t,e,r){var n=r(1);"string"==typeof n&&(n=[[t.i,n,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(3)(n,i);n.locals&&(t.exports=n.locals)},function(t,e,r){(t.exports=r(2)(!1)).push([t.i,"* {\n  box-sizing: border-box;\n}\np {\n  font-size: 10pt;\n}\nhtml,\nbody,\n#app {\n  height: 100%;\n}\n.app {\n  width: 100%;\n  height: 100%;\n  display: flex;\n}\n.app canvas {\n  flex: 2;\n}\n.app .tools {\n  position: relative;\n  flex: 1;\n  height: 100%;\n}\n.photo-block {\n  height: 60%;\n  width: 100%;\n  height: 90%;\n  overflow: scroll;\n}\n.photo-block .photo-header {\n  position: relative;\n}\n.photo-block .photo-header input[type=file] {\n  position: absolute;\n  left: 0px;\n  top: 0px;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  z-index: 1;\n}\n.photo-block .photo {\n  position: relative;\n  width: 100%;\n  height: 400px;\n  overflow: hidden;\n}\n.photo-block img {\n  position: absolute;\n  z-index: 0;\n  width: 100%;\n  overflow-x: auto;\n}\n.color-container {\n  position: absolute;\n  bottom: 0px;\n  width: 100%;\n  flex: 3;\n  height: 30%;\n}\n.color-container .range {\n  width: 100%;\n  text-align: center;\n  height: 16%;\n  position: relative;\n}\n.color-container .range .circle-pen {\n  pointer-events: none;\n  width: 10px;\n  top: 5px;\n  bottom: 5px;\n  vertical-align: center;\n  border: 1px solid black;\n}\n",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var i=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),o=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[r].concat(o).concat([i]).join("\n")}var s;return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<t.length;i++){var s=t[i];"number"==typeof s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),e.push(s))}},e}},function(t,e,r){var n,i,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=n.apply(this,arguments)),i}),c=function(t){var e={};return function(t,r){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),l=null,a=0,f=[],h=r(4);function p(t,e){for(var r=0;r<t.length;r++){var n=t[r],i=o[n.id];if(i){i.refs++;for(var s=0;s<i.parts.length;s++)i.parts[s](n.parts[s]);for(;s<n.parts.length;s++)i.parts.push(x(n.parts[s],e))}else{var c=[];for(s=0;s<n.parts.length;s++)c.push(x(n.parts[s],e));o[n.id]={id:n.id,refs:1,parts:c}}}}function u(t,e){for(var r=[],n={},i=0;i<t.length;i++){var o=t[i],s=e.base?o[0]+e.base:o[0],c={css:o[1],media:o[2],sourceMap:o[3]};n[s]?n[s].parts.push(c):r.push(n[s]={id:s,parts:[c]})}return r}function g(t,e){var r=c(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=f[f.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),f.push(e);else if("bottom"===t.insertAt)r.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=c(t.insertAt.before,r);r.insertBefore(e,i)}}function b(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=f.indexOf(t);e>=0&&f.splice(e,1)}function d(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return r.nc}();n&&(t.attrs.nonce=n)}return y(e,t.attrs),g(t,e),e}function y(t,e){Object.keys(e).forEach(function(r){t.setAttribute(r,e[r])})}function x(t,e){var r,n,i,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var s=a++;r=l||(l=d(e)),n=m.bind(null,r,s,!1),i=m.bind(null,r,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(e,t.attrs),g(t,e),e}(e),n=function(t,e,r){var n=r.css,i=r.sourceMap,o=void 0===e.convertToAbsoluteUrls&&i;(e.convertToAbsoluteUrls||o)&&(n=h(n));i&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var s=new Blob([n],{type:"text/css"}),c=t.href;t.href=URL.createObjectURL(s),c&&URL.revokeObjectURL(c)}.bind(null,r,e),i=function(){b(r),r.href&&URL.revokeObjectURL(r.href)}):(r=d(e),n=function(t,e){var r=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}.bind(null,r),i=function(){b(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else i()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=u(t,e);return p(r,e),function(t){for(var n=[],i=0;i<r.length;i++){var s=r[i];(c=o[s.id]).refs--,n.push(c)}t&&p(u(t,e),e);for(i=0;i<n.length;i++){var c;if(0===(c=n[i]).refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete o[c.id]}}}};var w,v=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function m(t,e,r,n){var i=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=v(e,i);else{var o=document.createTextNode(i),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var i,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(t,e,r){"use strict";r.r(e);var n=function(){},i={},o=[],s=[];function c(t,e){var r,c,l,a,f=s;for(a=arguments.length;a-- >2;)o.push(arguments[a]);for(e&&null!=e.children&&(o.length||o.push(e.children),delete e.children);o.length;)if((c=o.pop())&&void 0!==c.pop)for(a=c.length;a--;)o.push(c[a]);else"boolean"==typeof c&&(c=null),(l="function"!=typeof t)&&(null==c?c="":"number"==typeof c?c=String(c):"string"!=typeof c&&(l=!1)),l&&r?f[f.length-1]+=c:f===s?f=[c]:f.push(c),r=l;var h=new n;return h.nodeName=t,h.children=f,h.attributes=null==e?void 0:e,h.key=null==e?void 0:e.key,void 0!==i.vnode&&i.vnode(h),h}function l(t,e){for(var r in e)t[r]=e[r];return t}function a(t,e){null!=t&&("function"==typeof t?t(e):t.current=e)}var f="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;var h=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,p=[];function u(t){!t._dirty&&(t._dirty=!0)&&1==p.push(t)&&(i.debounceRendering||f)(g)}function g(){for(var t;t=p.pop();)t._dirty&&B(t)}function b(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function d(t){var e=l({},t.attributes);e.children=t.children;var r=t.nodeName.defaultProps;if(void 0!==r)for(var n in r)void 0===e[n]&&(e[n]=r[n]);return e}function y(t){var e=t.parentNode;e&&e.removeChild(t)}function x(t,e,r,n,i){if("className"===e&&(e="class"),"key"===e)   ;else if("ref"===e)a(r,null),a(n,t);else if("class"!==e||i)if("style"===e){if(n&&"string"!=typeof n&&"string"!=typeof r||(t.style.cssText=n||""),n&&"object"==typeof n){if("string"!=typeof r)for(var o in r)o in n||(t.style[o]="");for(var o in n)t.style[o]="number"==typeof n[o]&&!1===h.test(o)?n[o]+"px":n[o]}}else if("dangerouslySetInnerHTML"===e)n&&(t.innerHTML=n.__html||"");else if("o"==e[0]&&"n"==e[1]){var s=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),n?r||t.addEventListener(e,w,s):t.removeEventListener(e,w,s),(t._listeners||(t._listeners={}))[e]=n}else if("list"!==e&&"type"!==e&&!i&&e in t){try{t[e]=null==n?"":n}catch(t){}null!=n&&!1!==n||"spellcheck"==e||t.removeAttribute(e)}else{var c=i&&e!==(e=e.replace(/^xlink:?/,""));null==n||!1===n?c?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof n&&(c?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):t.setAttribute(e,n))}else t.className=n||""}function w(t){return this._listeners[t.type](i.event&&i.event(t)||t)}var v=[],m=0,_=!1,C=!1;function k(){for(var t;t=v.shift();)i.afterMount&&i.afterMount(t),t.componentDidMount&&t.componentDidMount()}function O(t,e,r,n,i,o){m++||(_=null!=i&&void 0!==i.ownerSVGElement,C=null!=t&&!("__preactattr_"in t));var s=U(t,e,r,n,o);return i&&s.parentNode!==i&&i.appendChild(s),--m||(C=!1,o||k()),s}function U(t,e,r,n,i){var o=t,s=_;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||i)?t.nodeValue!=e&&(t.nodeValue=e):(o=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(o,t),M(t,!0))),o.__preactattr_=!0,o;var c,l,a=e.nodeName;if("function"==typeof a)return function(t,e,r,n){var i=t&&t._component,o=i,s=t,c=i&&t._componentConstructor===e.nodeName,l=c,a=d(e);for(;i&&!l&&(i=i._parentComponent);)l=i.constructor===e.nodeName;i&&l&&(!n||i._component)?(R(i,a,3,r,n),t=i.base):(o&&!c&&(T(o),t=s=null),i=j(e.nodeName,a,r),t&&!i.nextBase&&(i.nextBase=t,s=null),R(i,a,1,r,n),t=i.base,s&&t!==s&&(s._component=null,M(s,!1)));return t}(t,e,r,n);if(_="svg"===a||"foreignObject"!==a&&_,a=String(a),(!t||!b(t,a))&&(c=a,(l=_?document.createElementNS("http://www.w3.org/2000/svg",c):document.createElement(c)).normalizedNodeName=c,o=l,t)){for(;t.firstChild;)o.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(o,t),M(t,!0)}var f=o.firstChild,h=o.__preactattr_,p=e.children;if(null==h){h=o.__preactattr_={};for(var u=o.attributes,g=u.length;g--;)h[u[g].name]=u[g].value}return!C&&p&&1===p.length&&"string"==typeof p[0]&&null!=f&&void 0!==f.splitText&&null==f.nextSibling?f.nodeValue!=p[0]&&(f.nodeValue=p[0]):(p&&p.length||null!=f)&&function(t,e,r,n,i){var o,s,c,l,a,f=t.childNodes,h=[],p={},u=0,g=0,d=f.length,x=0,w=e?e.length:0;if(0!==d)for(var v=0;v<d;v++){var m=f[v],_=m.__preactattr_,C=w&&_?m._component?m._component.__key:_.key:null;null!=C?(u++,p[C]=m):(_||(void 0!==m.splitText?!i||m.nodeValue.trim():i))&&(h[x++]=m)}if(0!==w)for(var v=0;v<w;v++){l=e[v],a=null;var C=l.key;if(null!=C)u&&void 0!==p[C]&&(a=p[C],p[C]=void 0,u--);else if(g<x)for(o=g;o<x;o++)if(void 0!==h[o]&&(k=s=h[o],S=i,"string"==typeof(O=l)||"number"==typeof O?void 0!==k.splitText:"string"==typeof O.nodeName?!k._componentConstructor&&b(k,O.nodeName):S||k._componentConstructor===O.nodeName)){a=s,h[o]=void 0,o===x-1&&x--,o===g&&g++;break}a=U(a,l,r,n),c=f[v],a&&a!==t&&a!==c&&(null==c?t.appendChild(a):a===c.nextSibling?y(c):t.insertBefore(a,c))}var k,O,S;if(u)for(var v in p)void 0!==p[v]&&M(p[v],!1);for(;g<=x;)void 0!==(a=h[x--])&&M(a,!1)}(o,p,r,n,C||null!=h.dangerouslySetInnerHTML),function(t,e,r){var n;for(n in r)e&&null!=e[n]||null==r[n]||x(t,n,r[n],r[n]=void 0,_);for(n in e)"children"===n||"innerHTML"===n||n in r&&e[n]===("value"===n||"checked"===n?t[n]:r[n])||x(t,n,r[n],r[n]=e[n],_)}(o,e.attributes,h),_=s,o}function M(t,e){var r=t._component;r?T(r):(null!=t.__preactattr_&&a(t.__preactattr_.ref,null),!1!==e&&null!=t.__preactattr_||y(t),S(t))}function S(t){for(t=t.lastChild;t;){var e=t.previousSibling;M(t,!0),t=e}}var P=[];function j(t,e,r){var n,i=P.length;for(t.prototype&&t.prototype.render?(n=new t(e,r),D.call(n,e,r)):((n=new D(e,r)).constructor=t,n.render=A);i--;)if(P[i].constructor===t)return n.nextBase=P[i].nextBase,P.splice(i,1),n;return n}function A(t,e,r){return this.constructor(t,r)}function R(t,e,r,n,o){t._disable||(t._disable=!0,t.__ref=e.ref,t.__key=e.key,delete e.ref,delete e.key,void 0===t.constructor.getDerivedStateFromProps&&(!t.base||o?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,n)),n&&n!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=n),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==r&&(1!==r&&!1===i.syncComponentUpdates&&t.base?u(t):B(t,1,o)),a(t.__ref,t))}function B(t,e,r,n){if(!t._disable){var o,s,c,a=t.props,f=t.state,h=t.context,p=t.prevProps||a,u=t.prevState||f,g=t.prevContext||h,b=t.base,y=t.nextBase,x=b||y,w=t._component,_=!1,C=g;if(t.constructor.getDerivedStateFromProps&&(f=l(l({},f),t.constructor.getDerivedStateFromProps(a,f)),t.state=f),b&&(t.props=p,t.state=u,t.context=g,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(a,f,h)?_=!0:t.componentWillUpdate&&t.componentWillUpdate(a,f,h),t.props=a,t.state=f,t.context=h),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!_){o=t.render(a,f,h),t.getChildContext&&(h=l(l({},h),t.getChildContext())),b&&t.getSnapshotBeforeUpdate&&(C=t.getSnapshotBeforeUpdate(p,u));var U,S,P=o&&o.nodeName;if("function"==typeof P){var A=d(o);(s=w)&&s.constructor===P&&A.key==s.__key?R(s,A,1,h,!1):(U=s,t._component=s=j(P,A,h),s.nextBase=s.nextBase||y,s._parentComponent=t,R(s,A,0,h,!1),B(s,1,r,!0)),S=s.base}else c=x,(U=w)&&(c=t._component=null),(x||1===e)&&(c&&(c._component=null),S=O(c,o,h,r||!b,x&&x.parentNode,!0));if(x&&S!==x&&s!==w){var D=x.parentNode;D&&S!==D&&(D.replaceChild(S,x),U||(x._component=null,M(x,!1)))}if(U&&T(U),t.base=S,S&&!n){for(var L=t,W=t;W=W._parentComponent;)(L=W).base=S;S._component=L,S._componentConstructor=L.constructor}}for(!b||r?v.push(t):_||(t.componentDidUpdate&&t.componentDidUpdate(p,u,C),i.afterUpdate&&i.afterUpdate(t));t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);m||n||k()}}function T(t){i.beforeUnmount&&i.beforeUnmount(t);var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var r=t._component;r?T(r):e&&(null!=e.__preactattr_&&a(e.__preactattr_.ref,null),t.nextBase=e,y(e),P.push(t),S(e)),a(t.__ref,null)}function D(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{},this._renderCallbacks=[]}function L(t,e,r){return O(r,t,{},!1,e,!1)}l(D.prototype,{setState:function(t,e){this.prevState||(this.prevState=this.state),this.state=l(l({},this.state),"function"==typeof t?t(this.state,this.props):t),e&&this._renderCallbacks.push(e),u(this)},forceUpdate:function(t){t&&this._renderCallbacks.push(t),B(this,2)},render:function(){}});function W(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){E(t,e,r[e])})}return t}function E(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let $={list:[],active:{lines:[],index:0,fill:{red:0,yellow:0,green:0,cyan:0,blue:0,magenta:0},editAll:!1}},Y=({list:t,active:e})=>({active:e,get list(){let r=0==e.lines.length,n=e.index==t.length;return r?t:n?[...t,e]:t.map(this.replace(e,e.index))},lines:e.lines,fill:e.fill,mutationPath:t=>({active:W({},e,t)}),delete:t=>(e,r)=>t!==r,replace:(t,e)=>(r,n)=>e==n?t:r,forTrans(t){},rotateAll:(t,r)=>{let n=({x:t,y:r})=>({x:t-e.lines[0].x,y:r-e.lines[0].y}),i=n(r),o=n(t),s=i.x**2+i.y**2,c=(o.x*i.x+o.y*i.y)/s,l=(i.x*o.y-i.y*o.x)/s,{x:a,y:f}=e.lines[0];return{lines:e.lines.map(t=>{let e=t.x-a,r=t.y-f,n=t.ax-a,i=t.ay-f;return(t=>({x:a+t.x,y:f+t.y,ax:a+t.ax,ay:f+t.ay}))({x:e*c-r*l,y:e*l+r*c,ax:n*c-i*l,ay:n*l+i*c})})}},moveAll:(t,r)=>({lines:e.lines.map(e=>({x:e.x+t.x-r.x,y:e.y+t.y-r.y,ax:e.ax+t.x-r.x,ay:e.ay+t.y-r.y}))})});function X(t){return{style(e){if(e){var{fill:r,stroke:n,lineWidth:i,opacity:o=1}=e,s={fillStyle:r,strokeStyle:n,globalAlpha:o,lineWidth:i};Object.keys(s).forEach(e=>{e in s&&(t[e]=function(t){if(Array.isArray(t)){let[e,r,n]=t;return`rgb(${e}, ${r}, ${n})`}if("object"==typeof t){let{red:e,green:r,blue:n}=t;return`rgb(${e}, ${r}, ${n})`}return t}(s[e]))})}},drawShape(e){t.beginPath(),this.draw[e.nodeName](e.attributes),t.save(),this.style(e.attributes),e.attributes.stroke&&t.stroke(),e.attributes.fill&&t.fill(),t.restore()},contain(e,r){if(!e)return;t.beginPath(),this.draw[e.nodeName](e.attributes),t.lineWidth=5;let{fill:n,stroke:i}=e.attributes;return n&&t.isPointInPath(r.x,r.y)||i&&t.isPointInStroke(r.x,r.y)},draw:{group(t){this.clear(t),t.children.forEach(t=>{this[t.nodeName](t.attributes)})},image(e){let r=new Image;r.onload=function(n){let{x:i=0,y:o=0,width:s=this.width,height:c=this.height}=e;t.drawImage(r,i,o,s,c)},r.src=e.src},ellipse(e){t.ellipse(e.cx,e.cy,e.r||e.rx,e.r||e.ry,e.rotate*Math.PI/180||2*Math.PI,0,2*Math.PI)},polyline(e){e.points.forEach((e,r)=>{r?t.lineTo(e.x,e.y):t.moveTo(e.x,e.y)})},path(e){let r=(r,n)=>{if(!n)return;let i=n.x,o=n.y,s=n.ax||i,c=n.ay||o,l=n.bx||2*i-s,a=n.by||2*o-c;return r?t.bezierCurveTo(r.ax,r.ay,l,a,i,o):(t.moveTo(i,o),e.lines.length<2&&t.lineTo(s,c)),{ax:s,ay:c,bx:l,by:a,x:i,y:o}},n=e.lines.reduce(r,null);e.close&&e.lines.length>1&&r(n,e.lines[0])}}}}function z(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let N=(t=(()=>({})),e=(()=>({})))=>(r,n)=>(class extends D{getProps(){let r=t(this.context.store),n=e(this.context.store);return Object.assign(r,((t,e)=>Object.entries(t).reduce((t,[r,n])=>(t[r]=function(){return e(n(...arguments))},t),{}))(n,this.context.decorator),this.props)}shouldComponentUpdate(){return!n||n(this.getProps(),this.props)}render(){return console.log({newProps:this.getProps()}),c(r,this.getProps())}});class K extends D{constructor(...t){super(...t),z(this,"target",{}),z(this,"getEvent",t=>{let e=this.base,r=e.getBoundingClientRect(),{top:n,left:i,scale:o}=this.props;return{clientX:i+(t.clientX-r.left)*e.width/o/e.clientWidth,clientY:n+(t.clientY-r.top)*e.height/o/e.clientHeight,which:t.which,shift:t.shiftKey,alt:t.altKey,ctrl:t.ctrlKey}}),z(this,"drawTo",()=>{if(!this.ctx)return;this.artist.style(this.props),this.props.redraw&&(this.ctx.save(),this.ctx.fillStyle=this.props.background,this.ctx.fillRect(0,0,this.base.width,this.base.height),this.ctx.restore());let t=(t,e)=>{let r=e.attributes;return this.artist.drawShape(e),(r.onClick||r.onChange||r.onFocus||r.onActive||r.onSubClick)&&t.push(e),t};this.dispatcher=[],this.dispatcher=this.props.children.reduce((e,r)=>{if(r){if("function"==typeof r.nodeName){let n=r.nodeName(r.attributes,this.context);return Array.isArray(n)||(n=[n]),n.reduce(t,e)}return t(e,r)}return e},[])}),z(this,"isEvent",!1),z(this,"catchTarget",(t,e)=>{if(Array.isArray(t)&&0==t.length)return;let r;return"function"==typeof t.nodeName&&this.catchTarget(t.nodeName(t.attributes),e),Array.isArray(t)?this.catchTarget(r=t.pop(),e)?r:this.catchTarget(t,e):this.artist.contain(t,e)?t:null}),z(this,"getTarget",t=>{let{dispatcher:e}=this,r=this.catchTarget(e,{x:t.clientX,y:t.clientY});return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){z(t,e,r[e])})}return t}({},this.props,r&&r.attributes||{})}),z(this,"count",0),z(this,"update",(t,e)=>{this.target[t]&&this.target[t](e,this.target)}),z(this,"managerMove",(t,e)=>r=>{"onChange"==e&&(this.count=0),this.update(e,{stop:t,move:this.getEvent(r),get diff(){return{clientX:this.move.clientX-this.stop.clientX,clientY:this.move.clientY-this.stop.clientY}}})}),z(this,"onMouseDown",t=>{this.count++;let e=this.getEvent(t);this.target=this.getTarget(e),this.base.onmousemove=this.managerMove(e,"onChange"),this.update("onActive",e)}),z(this,"onMouseUp",t=>{let e=this.getEvent(t);this.base.onmousemove=this.managerMove(e,"onFocus")}),z(this,"onClick",t=>{this.count&&this.update("onClick",this.getEvent(t))}),z(this,"onSubClick",t=>{t.preventDefault(),this.update("onSubClick",this.getEvent(t))}),z(this,"onKeyUp",t=>{let e=t.key.toLowerCase();this.props.onKey&&e in this.props.onKey&&this.props.onKey[e](this.target)})}shouldComponentUpdate(t){let{shouldUpdate:e}=this.props,{_changeData:r}=this.context;return Array.isArray(e)?e.some(t=>equals(t)):e.apply(this,arguments)}componentDidMount(){this.base.width=this.props.width||this.base.clientWidth,this.base.height=this.props.height||this.base.clientHeight,this.ctx=this.base.getContext("2d"),this.artist=X(this.ctx),this.drawTo()}componentDidUpdate(t,e){this.drawTo()}render(t){return c("canvas",{tabIndex:1e3,style:t.style,class:t.class,width:t.width,height:t.height,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove,onKeyUp:this.onKeyUp,onClick:this.onClick,onContextMenu:this.onSubClick})}}z(K,"defaultProps",{redraw:!0,stroke:"black",background:"white",fill:"transparent",opacity:1,lineWidth:1,top:0,left:0,scale:1,shouldUpdate:()=>!0});r(0);function F(){return(F=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function H(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){V(t,e,r[e])})}return t}function V(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function q(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}let G=t=>c("ellipse",{cx:t.x,cy:t.y,r:4,index:t.index,isfront:t.isfront,stroke:"black",fill:t.fill,onSubClick:t.onSubClick,onClick:t.onClick,onChange:t.onChange}),J=t=>{let{lines:e,fill:r}=t,n=q(t,["lines","fill"]);return c("path",{lines:e,fill:r,index:n.index,close:!0,lineWidth:1,onSubClick:n.onSelect})};var Q=N(t=>{let{list:e,active:r}=t;q(t,["list","active"]);return{list:e,active:r}},t=>{let{list:e,lines:r,active:n,replace:i}=t,o=q(t,["list","lines","active","replace"]);return{addPath:()=>({list:e,active:{lines:[],index:e.length,editAll:!1,fill:o.fill}}),pathSelect:(t,{editAll:r,lines:n,fill:i,index:o})=>({list:e,active:{editAll:r,lines:n,fill:i,index:o}}),deleteCircle:(t,{index:e})=>o.mutationPath({lines:r.filter(o.delete(e))}),change:({stop:t,move:e})=>o.mutationPath({lines:[...r,{x:t.clientX,y:t.clientY,ax:e.clientX,ay:e.clientY}]}),changeStart:(t,{index:e})=>o.mutationPath(0==e?{editAll:!n.editAll}:{lines:r.map((t,r,n)=>n[(e+r)%n.length])}),circleChange:({move:t},{index:e,cx:s,cy:c})=>{let l=i({x:t.clientX,y:t.clientY,ax:r[e].ax+t.clientX-r[e].x,ay:r[e].ay+t.clientY-r[e].y},e),a=0==e?o.moveAll:o.rotateAll;return o.mutationPath(n.editAll?a({x:t.clientX,y:t.clientY},{x:s,y:c}):{lines:r.map(l)})},directChange:({move:t},{index:e,isfront:n})=>o.mutationPath({lines:r.map(i(H({},r[e],{ax:n?t.clientX:2*r[e].x-t.clientX,ay:n?t.clientY:2*r[e].y-t.clientY}),e))})}})(t=>{let{list:e,active:r}=t;return console.log({list:e,active:r}),c(K,{lineWidth:1,onClick:t.click,onChange:t.change,onSubClick:t.addPath},e.map((e,r)=>c(J,F({},e,{onSelect:t.pathSelect}))),r.lines.map((e,n)=>[0==n||n==r.lines.length-1?[c("polyline",{points:[{x:e.ax,y:e.ay},{x:2*e.x-e.ax,y:2*e.y-e.ay}],fill:"grey",lineWidth:3,stroke:"lightgrey"}),c(G,{index:n,x:e.ax,y:e.ay,isfront:!0,onChange:t.directChange,fill:"blue"}),c(G,{index:n,x:2*e.x-e.ax,y:2*e.y-e.ay,onChange:t.directChange,isfront:!1,fill:"blue"})]:null,c(G,F({},e,{index:n,fill:n?"orange":r.editAll?"green":"red",onSubClick:t.deleteCircle,onChange:t.circleChange,onClick:t.changeStart}))]))});function Z(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function I(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),n.forEach(function(e){et(t,e,r[e])})}return t}function tt(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||(i[r]=t[r]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}function et(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class rt extends D{constructor(...t){super(...t),et(this,"onMouseDown",t=>{this.onChange(t)}),et(this,"onChange",t=>{let e=this.getValue(t);this.props.onChange({[this.props.name]:e})}),et(this,"getValue",t=>{let{max:e,min:r,type:n}=this.props,i=e-r,o=this.sizer,s="vertical"==n?t.clientX-o.left:t.clientY-o.top;return"vertical"==n?Math.floor(r+i*s/o.width):Math.floor(r+i*s/o.height)})}componentDidMount(){let t=this.base.getBoundingClientRect();this.sizer={height:t.bottom-t.top,width:t.right-t.left,left:t.left,top:t.top},this.forceUpdate()}render(t,e,{gradient:r,textRgb:n}){let{min:i,max:o,value:s,name:l}=t,a=tt(t,["min","max","value","name"]);!1 in this.props&&(s=Math.round((i+o)/2));let f=s*(this.sizer&&this.sizer.width||100)/(o-i);return c("div",{class:"range",onMouseDown:this.onMouseDown,onMouseMove:t=>{this.on&&this.onChange(t)},onMouseUp:()=>{this.on=!1},onMouseLeave:()=>{this.on=!1,this.in=!1},onMouseEnter:()=>{this.in=!0},onDragStart:()=>!1,style:{background:a.gradient}},c("div",{class:"circle-pen",style:{position:"absolute",left:f-5+"px",backgroundColor:a.textRgb}}))}}et(rt,"defaultProps",{min:0,max:100,type:"vertical"});var nt=N(({fill:t})=>{let{red:e,green:r,blue:n,yellow:i,cyan:o,magenta:s}=t,c=(t,e,r,n)=>`rgb(${t}, ${e}, ${r}) ${void 0!==n?n/255*100+"%":""}`,l=t=>Array.isArray(t)?c(...t):c(e,r,n,t),a=(...t)=>`linear-gradient(to right, ${t.map(l).join(", ")})`;return{color:t,textRgb:c(e,r,n),gradient:{red:a([0,r,n],e,[255,r,n,255]),yellow:a([0,0,n],i,[255,255,n,255]),green:a([e,0,n],r,[e,255,n,255]),cyan:a([e,0,0],o,[e,255,255,255]),blue:a([e,r,0],n,[e,r,255,255]),magenta:a([0,r,0],s,[255,r,255,255])}}},t=>{let{fill:e}=t,r=tt(t,["fill"]);return{changeColor:t=>{console.log(t);let{red:n,yellow:i,green:o,cyan:s,blue:c,magenta:l}=e,a=(t,e,r,n,i)=>{let o=i[e]&&{state:n[e],change:i[e]}||i[r]&&{state:n[r],change:i[r]};return o?(o.getkoff=function(t){let{state:e,change:r}=this,n=r>e?255:0,i=t+(r-e)*(t-n)/(e-n);return r==n?n:Math.round(i)},o.getkoff(t)):t};return r.mutationPath({fill:I({red:a(n,"yellow","magenta",e,t),yellow:a(i,"red","green",e,t),green:a(o,"yellow","cyan",e,t),cyan:a(s,"green","blue",e,t),blue:a(c,"cyan","magenta",e,t),magenta:a(l,"blue","red",e,t)},t)})}}})(({color:t,gradient:e,textRgb:r,changeColor:n})=>c("div",{class:"color-container"},Object.entries(t).map(([t,i])=>c(rt,{name:t,value:i,textRgb:r,gradient:e[t],max:255,onChange:n}))));function it(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}L(c(class extends D{constructor(...t){super(...t),it(this,"state",$),it(this,"getChildContext",()=>{let t=Y(this.state);for(let e in t)"function"==typeof t[e]&&(t[e]=t[e].bind(t));return{store:t,decorator:t=>{console.info("setState-----------",t),this.setState(t)}}})}render(){return c("div",{class:"app"},this.props.children)}},null,c(Q,null),c("div",{class:"tools"},c(class extends D{constructor(...t){super(...t),Z(this,"state",{scale:1,left:0,top:0}),Z(this,"choosePhoto",t=>{let e=new FileReader;e.onload=(()=>{this.setState({src:e.result})}),e.readAsDataURL(t.target.files[0])})}render(t,e){return c("div",{class:"photo-block"},c("div",{class:"photo-header"},c("button",null," Фотка "),c("input",{type:"file",onChange:this.choosePhoto})),c("div",{class:"photo",ref:t=>{if(null==t)return;let{left:e,top:r}=t.getBoundingClientRect();this.changeScale=(({pageX:t,pageY:n,deltaY:i})=>{this.setState(o=>({top:o.top+(o.top+(n-r))*i/500,left:o.left+(o.left+(t-e))*i/500,scale:o.scale*(500+i)/500}))})}},c("img",{src:e.src,onWheel:this.changeScale,style:{top:-e.top+"px",left:-e.left+"px",width:100*e.scale+"%",height:"auto"}})))}},null),c(nt,null))),document.querySelector("#app"))}]);
//# sourceMappingURL=bundle.js.map